---
title: "4:19:39 PM - August 9, 2025"
date: 2025-08-09T23:19:39.682Z
timestamp: 1754781579682
---

## Project Notes

Token Usage Architecture Issue:

The session GET endpoint (route.ts:47-48) is doing:
```typescript
const events = mainAgent.threadManager.getEvents(mainAgent.threadId);
const tokenSummary = aggregateTokenUsage(events);
```

This is wrong! It should be asking the Agent for its token usage, not calculating it separately. The Agent has a TokenBudgetManager that already tracks this.

The endpoint does try to get the TokenBudgetManager for the context limit (line 51-52), but then calculates the actual usage separately. This creates two sources of truth for token counting.
