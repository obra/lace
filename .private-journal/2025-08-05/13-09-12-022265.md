---
title: "1:09:12 PM - August 5, 2025"
date: 2025-08-05T17:09:12.022Z
timestamp: 1754413752022
---

## Project Notes

The Lace codebase has sophisticated test infrastructure but suffered from a coordination problem between two isolation mechanisms. The persistence-helper.ts was creating its own temp database paths while temp-lace-dir.ts was managing LACE_DIR environment variable isolation.

The ProviderInstanceManager relies on getLaceDir() which uses LACE_DIR, so when tests run in parallel:
- Each test gets isolated LACE_DIR via temp-lace-dir  
- But persistence-helper creates database in separate random temp location
- Provider instances written to LACE_DIR can get cleaned up before other parallel tests finish
- Result: "Provider instance not found: test-anthropic" errors

Key insight: Test isolation must be holistic - all temp storage must use the same isolated directory, not different temp locations that can race against each other.
