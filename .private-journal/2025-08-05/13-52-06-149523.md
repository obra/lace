---
title: "1:52:06 PM - August 5, 2025"
date: 2025-08-05T17:52:06.149Z
timestamp: 1754416326149
---

## Project Notes

Jesse makes an excellent point. If we need to modify every test file anyway, why maintain two separate utilities? The cleaner approach would be to:

1. Merge the persistence setup functionality directly into `temp-lace-dir.ts`
2. Make it a single, unified test utility that handles both LACE_DIR isolation AND database setup
3. Eliminate the need for separate `setupTestPersistence()` calls entirely
4. Make it impossible to do the wrong thing (separate temp directories)

This follows the principle of "make it hard to do wrong" - if there's only one utility that handles everything, developers can't accidentally create race conditions.

The unified approach would be:
```typescript
// In test files:
const tempLaceDir = useTempLaceDir(); // This sets up BOTH LACE_DIR and persistence automatically

// No more separate setupTestPersistence() calls needed
```

Much cleaner and simpler. Jesse is absolutely right.
