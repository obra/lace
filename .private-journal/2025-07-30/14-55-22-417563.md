---
title: "2:55:22 PM - July 30, 2025"
date: 2025-07-30T18:55:22.417Z
timestamp: 1753901722417
---

## Project Notes

Looking at the data flow, I found the key difference! The history route in `/app/api/sessions/[sessionId]/history/route.ts` at lines 117-119 properly extracts text content from ToolResult:

```typescript
const resultContent = toolResultData.content
  .map((block: { text?: string }) => block.text ?? '')
  .join('');
```

This converts the ToolResult object with `content: ContentBlock[]` into a simple string for the SessionEvent format.

But looking at the timeline-converter.ts at line 166, it's passing raw data:
```typescript
result: result?.data
```

And then in the TOOL_AGGREGATED case at lines 258-264, it tries to handle both formats but this is hacky.

The issue is clear now - the SSE stream is passing raw ToolResult objects while the history route converts them to strings. We need to ensure both paths use the same format conversion.
