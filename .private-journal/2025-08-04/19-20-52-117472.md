---
title: "7:20:52 PM - August 4, 2025"
date: 2025-08-04T23:20:52.117Z
timestamp: 1754349652117
---

## Project Notes

Analyzed E2E test infrastructure. Current state:

**File Organization:**
- `/e2e/` directory: 4 main E2E test files (api-endpoints, sse-integration, task-event-deduplication, web-ui)
- Scattered `.e2e.test.ts/tsx` files: 3 files (useSSEStream, task-api client, useTaskManager)

**Key Issues Identified:**

1. **Inconsistent Setup/Teardown Patterns:**
   - Some tests use `setupTestPersistence()` + `teardownTestPersistence()` (good)
   - Some manually manage env vars and globals
   - Agent cleanup inconsistent - some use `stopAllAgents()`, some just `clearActiveSessions()`
   - Timing issues: some add delays, some don't

2. **Mock vs Real Testing Confusion:**
   - Mixed approach: some tests use real services, others mock everything
   - Fetch mocking is complex and duplicated across files
   - No consistent mock strategy for external dependencies

3. **Complex Test Patterns:**
   - task-api.e2e.test.ts has 200+ lines of complex URL routing logic
   - Duplicate routing logic between test files
   - Heavy use of NextRequest/Response mocking instead of simpler approaches

4. **No Shared E2E Utilities:**
   - Each test file reinvents session creation, project setup
   - No shared helpers for common E2E operations
   - No standardized assertion patterns

5. **Performance Issues:**
   - Tests create real database connections, projects, sessions for each test
   - No test data factories or builders
   - Some tests run sequentially due to shared state concerns

**Positive Patterns:**
- Good use of `setupTestPersistence()` helper
- Proper environment isolation with `:memory:` databases
- Tests actually validate end-to-end flows
- Good coverage of API routes and SSE functionality
