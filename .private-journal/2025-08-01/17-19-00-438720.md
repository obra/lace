---
title: "5:19:00 PM - August 1, 2025"
date: 2025-08-01T21:19:00.438Z
timestamp: 1754083140438
---

## Project Notes

Fixed the duplicate task event bug that was causing dozens of events per task creation. The issue was in SessionService calling registerSession multiple times.

Key files changed:
- /packages/web/lib/server/session-service.ts - Added WeakSet for agent deduplication
- /packages/web/lib/event-stream-manager.ts - WeakSet for TaskManager deduplication (already existed)

The fix ensures:
1. TaskManager events only registered once per TaskManager instance
2. Agent event handlers only set up once per Agent instance  
3. Sessions are properly registered even after server restarts
4. No memory leaks from duplicate EventEmitter listeners

Tests passing and the EventStreamManager logs show single registration per session.
