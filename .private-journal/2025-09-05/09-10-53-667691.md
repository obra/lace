---
title: "9:10:53 AM - September 5, 2025"
date: 2025-09-05T16:10:53.667Z
timestamp: 1757088653667
---

## Project Notes

## Lace API Architecture Analysis - Key Patterns Discovered

### Core Architecture Pattern: Project > Session > Resource Hierarchy
Lace follows a strict hierarchical resource model:
- **Projects** are top-level resources with working directories, configurations, and metadata
- **Sessions** belong to projects and inherit/override project configuration 
- **Tasks/Agents/Files** belong to sessions and access both project and session context

### Route Pattern: Nested Resource URLs
- Projects: `/api/projects/$projectId`
- Sessions: `/api/projects/$projectId/sessions/$sessionId` (NOT standalone `/api/sessions/$sessionId`)
- Tasks: `/api/projects/$projectId/sessions/$sessionId/tasks/$taskId`

This enforces proper resource ownership and context propagation.

### Configuration Inheritance Pattern
1. **Project configuration** (base level)
2. **Session configuration** (inherits + overrides project)
3. **Effective configuration** = merged result used by agents/tools

Key insight: ConfigurationValidator.mergeConfigurations() handles the inheritance logic.

### Authentication/Authorization Pattern
- No explicit user auth in current implementation (single-user system)
- Resource ownership enforced through nested routes
- Project.getById() + Project.getSession() ensures sessions belong to projects
- Validation schemas (ProjectIdSchema, SessionIdSchema) enforce proper ID formats

### Service Layer Pattern
- **Business Logic Classes**: Project, Session, ToolExecutor, TaskManager live in ~/packages/core/src
- **Web Service Layer**: SessionService, getSessionService() provide web-specific abstractions
- **API Routes**: Thin handlers that validate, delegate to services, return responses

### ToolExecutor Usage Pattern
- Created fresh per request: `new ToolExecutor()`
- Registers all available tools: `toolExecutor.registerAllAvailableTools()`
- Filters user-configurable tools: `!tool.annotations?.safeInternal`
- Used for configuration endpoints to return availableTools list

### Error Handling Pattern
- Consistent error structure: { error: string, code?: string, details?: unknown }
- Validation errors always 400 with VALIDATION_FAILED code
- Resource not found always 404 with RESOURCE_NOT_FOUND code
- createErrorResponse() helper ensures consistency

### Response Pattern
- All responses use SuperJSON for rich object serialization (dates, etc.)
- createSuperjsonResponse() wrapper handles serialization
- Validation schemas define both input and output structure
